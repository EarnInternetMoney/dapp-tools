#!/usr/bin/env nix-shell
#! nix-shell -i bash -p cachix curl jq

{ # Prevent execution if this script was only partially downloaded
  set -e

  oops() {
    >&2 echo "error:" "$1"
    exit 1
  }

  [[ "$(id -u)" -eq 0 ]] && oops "Please run this script as a regular user"

  URL=$(curl -sS https://api.github.com/repos/dapphub/dapptools/releases/latest | jq -r .tarball_url)

  [[ $URL == null ]] && oops "Could not fetch latest release, please file an issue at https://github.com/dapphub/dapp-tools/issues/new"

  cachix use dapp
  nix-env -iA dapp hevm seth -f "$URL"

} # End of wrapping
